#!/usr/bin/env cached-nix-shell
#! nix-shell -i sh -p xidel

format=${1:-markdown}
url=${2:-$(xclip -o -selection clipboard)}

# if pdf don't grab title
if [[ $url == *.pdf ]]; then
    title=""
else
    # Use xidel to fetch the page and extract the title with sed
    title=$(url2title "$url")
fi

if [[ $format == "title" ]]; then
    printf "$url\n$title"
else
    echo "[$title]($url)"
fi